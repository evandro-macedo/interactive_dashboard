<%# Subscribe to Turbo Stream broadcasts for automatic updates %>
<%= turbo_stream_from "construction_overview" %>

<!-- Page Header with Modern Layout -->
<div class="page-header-wrapper">
  <div class="page-header-content">
    <h1 class="h3 mb-0">Construction Overview Dashboard</h1>
    <p class="page-header-subtitle">
      <i class="bi bi-bar-chart-line-fill"></i>
      Real-time insights from <%= number_with_delimiter(@total_records) %> construction logs
    </p>
  </div>

  <!-- Simple Sync Status Badge -->
  <% if @last_sync %>
    <%
      minutes_ago = ((Time.current - @last_sync.synced_at) / 60).to_i
      badge_class = if @last_sync.failed?
                      'sync-badge-error'
                    elsif minutes_ago > 10
                      'sync-badge-warning'
                    else
                      'sync-badge-success'
                    end
      icon_class = @last_sync.failed? ? 'bi-exclamation-triangle-fill' : 'bi-check-circle-fill'
      formatted_total = (@total_records >= 1000) ? "#{(@total_records / 1000.0).round(1)}K" : @total_records.to_s
      duration_s = (@last_sync.duration_ms / 1000.0).round(1)
    %>
    <div class="sync-status-badge <%= badge_class %>">
      <i class="bi <%= icon_class %> me-2"></i>
      <span class="fw-semibold">Updated <%= time_ago_in_words(@last_sync.synced_at) %> ago</span>
      <span class="mx-1 text-muted">•</span>
      <span><i class="bi bi-database me-1"></i><%= formatted_total %></span>
      <span class="mx-1 text-muted">•</span>
      <span><i class="bi bi-lightning-fill me-1"></i><%= duration_s %>s</span>
    </div>
  <% end %>
</div>

<!-- Main Content (will be auto-updated via Turbo Streams) -->
<div id="construction_overview_content">
  <%= render "content" %>
</div>
